<!DOCTYPE html>
<html>
<head>
  <title>人臉註冊系統</title>
  <style>
    body { font-family: Arial; padding: 20px; text-align: center; }
    input, button { font-size: 16px; padding: 5px; margin: 10px 0; }
    video, canvas { display: block; margin: auto; }
    #message { margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>人臉註冊系統</h2>

  <form id="registerForm">
    姓名：<input type="text" id="name" name="name" required />
    <br>
    <video id="video" width="320" height="240" autoplay></video>
    <br>
    <button type="submit">註冊</button>
  </form>

  <canvas id="canvas" width="320" height="240" style="display: none;"></canvas>
  <div id="message"></div>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // 啟用攝影機
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => video.srcObject = stream)
      .catch(err => alert('無法開啟攝影機：' + err));

    document.getElementById('registerForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      if (!name) return alert("請輸入姓名");

      // 拍照
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const imageData = canvas.toDataURL('image/jpeg');

      // 傳送資料
      const res = await fetch('https://f3f0dd590a09.ngrok-free.app/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, image: imageData })
      });

      const data = await res.json();
      const msgDiv = document.getElementById('message');
      msgDiv.textContent = data.message;
      msgDiv.style.color = data.status === 'success' ? 'green' : 'red';
    });
  </script>
</body>
</html>

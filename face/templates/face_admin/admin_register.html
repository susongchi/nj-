<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>後台註冊</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --brand:#E5484D;
  --brand-ink:#C53B3F;
  --bg:#F3F4F6;
  --card:#FFFFFF;
  --ink:#111827;
  --muted:#6B7280;
  --line:#E5E7EB;
  --ring:rgba(229,72,77,.35);
  --error:#DC2626;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg);
  display:grid; place-items:center; padding:24px;
  font-family:"Noto Sans TC",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  color:var(--ink);
}

/* 卡片 */
section{
  width:100%; max-width:440px;
  background:var(--card);
  border:1px solid rgba(0,0,0,.04);
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.06);
  padding:32px;
}

/* 頂部 */
.header{display:flex; align-items:center; gap:12px; justify-content:center; margin-bottom:8px}
.header img{width:36px; height:36px}
.header .title{margin:0; font-size:22px; font-weight:700; letter-spacing:.3px; text-align:center}
.sub{color:var(--muted); font-size:14px; margin-bottom:18px; text-align:center}

/* 欄位 */
.form-group{margin-bottom:16px}
.label{display:block; font-size:13px; color:#374151; margin-bottom:6px}
.input-wrap{position:relative}
.input{
  width:100%; height:44px; padding:0 14px;
  border:1px solid var(--line); border-radius:12px; background:#fff;
  outline:0; font-size:15px;
}
.input::placeholder{color:#9CA3AF}
.input:focus{border-color:var(--brand); box-shadow:0 0 0 4px var(--ring)}

/* 密碼眼睛 */
.toggle-eye{
  position:absolute; right:8px; top:50%; transform:translateY(-50%);
  border:0; background:transparent; cursor:pointer; padding:6px; border-radius:8px;
}
.toggle-eye:focus{box-shadow:0 0 0 4px var(--ring)}
.toggle-eye svg{width:20px; height:20px; stroke:#6B7280}
.toggle-eye .icon-closed{ display:none; }
.toggle-eye.showing .icon-open{ display:none; }
.toggle-eye.showing .icon-closed{ display:inline; }

/* 連結區 */
.links{
  display:flex; align-items:center; justify-content:center;
  gap:10px; margin:6px 0 18px; font-size:14px;
}
a{color:var(--muted); text-decoration:none; transition:.2s}
a:hover{color:var(--ink); text-decoration:underline}

/* 按鈕 */
.btn{
  width:100%; height:46px; border:0; border-radius:12px; cursor:pointer;
  font-size:15px; font-weight:700; letter-spacing:.3px;
}
.btn-primary{ background:var(--brand); color:#fff; box-shadow:0 6px 16px rgba(229,72,77,.25) }
.btn-primary:hover{ background:var(--brand-ink) }
.btn:disabled{ opacity:.6; cursor:not-allowed }

/* 訊息 */
#message{ margin-top:10px; font-size:14px; text-align:center }
.hint{margin-top:8px; color:#b45309; font-size:13px; display:none}
</style>
</head>

<body>
<section>
  <div class="header">
    <img src="https://i.ibb.co/PZVYTR1N/logo-12-1.png" alt="Logo">
    <h2 class="title">後台註冊</h2>
  </div>
  <div class="sub">建立管理員帳號</div>

  <div class="form-group">
    <label class="label" for="username">帳號</label>
    <div class="input-wrap">
      <input class="input" id="username" type="text" placeholder="請輸入帳號" required>
    </div>
  </div>

  <div class="form-group">
    <label class="label" for="password">密碼</label>
    <div class="input-wrap">
      <input class="input" id="password" type="password" placeholder="請輸入密碼" required>
      <button type="button" id="togglePwd" class="toggle-eye" aria-label="顯示密碼" aria-pressed="false">
        <!-- 開眼 -->
        <svg class="icon icon-open" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7Z"/>
          <circle cx="12" cy="12" r="3"/>
        </svg>
        <!-- 闔眼 -->
        <svg class="icon icon-closed" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M3 3l18 18"/>
          <path d="M2 12s4-7 10-7c2.4 0 4.6.8 6.5 2.1"/>
          <path d="M22 12s-4 7-10 7c-2.4 0-4.6-.8-6.5-2.1"/>
          <path d="M14.1 14.1A3 3 0 0 1 9.9 9.9"/>
        </svg>
      </button>
    </div>
    <div id="capsHint" class="hint">Caps Lock 可能開啟</div>
  </div>

  <div class="form-group">
    <label class="label" for="email">信箱</label>
    <div class="input-wrap">
      <input class="input" id="email" type="email" placeholder="請輸入信箱" required>
    </div>
  </div>

  <div class="links">
    <span style="color:var(--muted)">已經有帳號？</span>
    <a href="/admin_login">前往登入</a>
  </div>

  <button id="registerBtn" class="btn btn-primary" disabled>註冊</button>
  <div id="message"></div>
</section>

<script>
  let ip = "https://322b23d6594f.ngrok-free.app";

  const usernameEl = document.getElementById("username");
  const passwordEl = document.getElementById("password");
  const emailEl    = document.getElementById("email");
  const msgDiv     = document.getElementById("message");
  const btn        = document.getElementById("registerBtn");
  const toggle     = document.getElementById("togglePwd");
  const inputs     = [usernameEl, passwordEl, emailEl];

  let inFlight = false;

  function syncBtn(){
    btn.disabled = !(usernameEl.value.trim() && passwordEl.value.trim() && emailEl.value.trim());
  }
  inputs.forEach(el => el.addEventListener('input', syncBtn));
  syncBtn();

  // 眼睛切換（和登入一致）
  toggle.addEventListener("click", () => {
    const show = passwordEl.type === "password";
    passwordEl.type = show ? "text" : "password";
    toggle.classList.toggle("showing", show);
    toggle.setAttribute("aria-pressed", show);
    toggle.setAttribute("aria-label", show ? "隱藏密碼" : "顯示密碼");
  });

  // Caps Lock 提示
  const capsHint = document.getElementById("capsHint");
  passwordEl.addEventListener("keyup", (e)=>{
    if (e.getModifierState && e.getModifierState("CapsLock")) {
      capsHint.style.display = "block";
    } else {
      capsHint.style.display = "none";
    }
  });

  async function handleregister(){
    if (inFlight) return;

    const username = usernameEl.value.trim();
    const password = passwordEl.value.trim();
    const email    = emailEl.value.trim();

    if (!username || !password || !email) {
      msgDiv.textContent = "請填寫所有欄位";
      msgDiv.style.color = "var(--error)";
      return;
    }

    inFlight = true;
    const oldText = btn.textContent;
    btn.disabled = true;
    btn.textContent = "註冊中…";
    msgDiv.textContent = "";

    try{
      const res = await fetch(`${ip}/api/admin_register`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password, email })
      });

      const data = await res.json();

      if (data.status === "success") {
        msgDiv.style.color = "#16a34a";
        msgDiv.textContent = "註冊成功，為你跳轉登入頁…";
        // 若不想自動跳轉，把下一行註解掉即可
        setTimeout(()=>{ window.location.href = "/admin_login"; }, 700);
      } else {
        msgDiv.style.color = "var(--error)";
        msgDiv.textContent = data.message || "註冊失敗";
      }
    }catch(err){
      msgDiv.style.color = "var(--error)";
      msgDiv.textContent = "網路連線失敗，請稍後再試";
    }finally{
      inFlight = false;
      btn.textContent = oldText;
      syncBtn();
    }
  }

  // Enter 送出（保留你的行為）
  inputs.forEach(el => el.addEventListener("keydown", e => {
    if (e.key === "Enter") handleregister();
  }));
  btn.onclick = handleregister;
</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <title>管理後台</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 800px; margin: auto; }
    h2, h3 { margin-bottom: 10px; }
    input, button, select, textarea { font-size: 14px; margin: 5px 0; padding: 6px; width: 100%; }
    #faceList img { width: 50px; height: 50px; margin-right: 10px; border-radius: 5px; vertical-align: middle; }
    #faceList div { margin-bottom: 8px; }
    #scheduleList { margin-top: 20px; }
    #message, #registerMsg, #loginMsg { margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>人臉管理與會議排程</h2>

  <section id="loginSection">
    <h3>管理員登入</h3>
    <label for="adminUser">帳號</label>
    <input type="text" id="adminUser" placeholder="請輸入帳號" />

    <label for="adminPass">密碼</label>
    <input type="password" id="adminPass" placeholder="請輸入密碼" />

    <button id="loginBtn">登入</button>
    <button id="logoutBtn" style="display:none">登出</button>
    <div id="loginMsg"></div>
  </section>

  <div id="mainContent" style="display:none;">
    <section>
      <h3>新增使用者</h3>
      <label for="newName">姓名</label>
      <input type="text" id="newName" placeholder="請輸入姓名" />

      <label for="newPhoto">上傳人臉照片</label>
      <input type="file" id="newPhoto" accept="image/*" />

      <button id="registerBtn">註冊使用者</button>
      <div id="registerMsg"></div>
    </section>

    <section>
      <h3>已註冊人臉</h3>
      <div id="faceList">載入中...</div>
    </section>

    <section>
      <h3>設定排程</h3>
      <label for="meetingName">會議名稱</label>
      <input type="text" id="meetingName" placeholder="請輸入會議名稱" />

      <label for="date">會議日期</label>
      <input type="date" id="date" />

      <label for="startTime">開始時間</label>
      <input type="time" id="startTime" />

      <label for="endTime">結束時間</label>
      <input type="time" id="endTime" />

      <label>選擇參與者</label>
      <div id="participantsCheckboxes">載入中...</div>

      <button id="saveScheduleBtn">儲存排程</button>
      <div id="message"></div>
    </section>

    <section id="scheduleList">
      <h3>現有會議排程</h3>
      <div id="schedules">載入中...</div>
    </section>
  </div>

<script>
let ip = "https://f3f0dd590a09.ngrok-free.app/api";

async function login() {
  const username = document.getElementById('adminUser').value;
  const password = document.getElementById('adminPass').value;
  const res = await fetch(`${ip}/admin_login`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username, password }),
    credentials: "include"
  });
  const data = await res.json();
  const msg = document.getElementById("loginMsg");
  if (data.status === "success") {
    msg.style.color = 'green';
    msg.textContent = data.message;
    document.getElementById("mainContent").style.display = "block";
    document.getElementById("logoutBtn").style.display = "inline";
    document.getElementById("loginBtn").style.display = "none";
    document.getElementById("loginSection").style.display = "none";
    loadFaces();
    loadSchedules();
  } else {
    msg.style.color = 'red';
    msg.textContent = data.message;
  }
}

async function logout() {
  await fetch(`${ip}/admin_logout`, {
    credentials: "include"
  });
  location.reload();
}

document.getElementById("loginBtn").onclick = login;
document.getElementById("logoutBtn").onclick = logout;
</script>
</body>
</html>
